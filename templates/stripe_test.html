<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Stripe Test Checkout</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 2rem; }
        .field { margin: 1rem 0; }
        #card-element { padding: 12px; border: 1px solid #ccc; border-radius: 8px; }
        button { padding: 10px 16px; border-radius: 8px; border: none; background: #635bff; color: #fff; cursor: pointer; }
        button:disabled { opacity: .5; cursor: not-allowed; }
        .row { margin: .5rem 0; }
        .muted { color: #666; font-size: .9rem; }
        pre { background: #f6f8fa; padding: 12px; border-radius: 6px; overflow-x: auto; }
    </style>
</head>
<body>
<h2>Stripe Test Checkout</h2>

<div class="row muted">Publishable key loaded: {{ stripe_publishable_key|default:"(missing)" }}</div>

<div class="field">
    <label>Client Secret</label>
    <input id="clientSecret" value="{{ client_secret|default:"" }}" style="width: 100%; padding: 8px;" />
    <div class="muted">Paste the client_secret returned by your API here.</div>
  </div>

<div class="field">
  <label>Card</label>
  <div id="card-element"></div>
</div>

<div class="field">
  <button id="pay">Pay</button>
</div>

<div id="result"></div>

<script src="https://js.stripe.com/v3/"></script>
<script>
  const publishableKey = "{{ stripe_publishable_key|default:'' }}";
  const stripe = Stripe(publishableKey);
  const elements = stripe.elements();
  const card = elements.create('card');
  card.mount('#card-element');

  const setDisabled = (v) => { document.getElementById('pay').disabled = v; };
  const log = (obj) => {
    document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(obj, null, 2) + '</pre>';
  };

  document.getElementById('pay').onclick = async () => {
    setDisabled(true);
    const clientSecret = document.getElementById('clientSecret').value;
    if (!clientSecret) { alert('Missing client_secret'); setDisabled(false); return; }
    const {error, paymentIntent} = await stripe.confirmCardPayment(clientSecret, { payment_method: { card } });
    if (error) { log({ error: error.message }); }
    else { log(paymentIntent); }
    setDisabled(false);
  };
</script>
</body>
</html>


